{"ast":null,"code":"import _regeneratorRuntime from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/irfan91/Desktop/aplikasi-keuangan/src/scenes/private/home /index.js\";\nimport React, { useState, useEffect } from 'react';\nimport Button from '@material-ui/core/Button';\nimport List from '@material-ui/core/List';\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport ImageIcon from \"@material-ui/icons/Image\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Table from \"@material-ui/core/Table\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\"; //firebase hook\n\nimport { useFirebase } from '../../../components/FirebaseProvider';\nimport { useCollection } from 'react-firebase-hooks/firestore'; //import komponent \n\nimport AppLoading from \"../../../components/AppLoading\"; //import style\n\nimport useStyles from \"./style\"; //import notifikasi\n\nimport { useSnackbar } from \"notistack\"; //import helper\n\nimport { currency } from \"../../../helpers/formatter\"; // import date format\n\nimport format from \"date-fns/format\";\nimport { parse } from 'date-fns';\nexport default function Home() {\n  const _useFirebase = useFirebase(),\n        auth = _useFirebase.auth,\n        firestore = _useFirebase.firestore,\n        user = _useFirebase.user;\n\n  const produkCol = firestore.collection(\"toko/\".concat(user.uid, \"/produk\"));\n  const transaksiCol = firestore.collection(\"toko/\".concat(user.uid, \"/transaksi\"));\n  const todayDateString = format(new Date(), 'yyyy-MM-dd');\n\n  const _useCollection = useCollection(produkCol),\n        _useCollection2 = _slicedToArray(_useCollection, 2),\n        snapshotProduk = _useCollection2[0],\n        loadingProduk = _useCollection2[1];\n\n  const _useCollection3 = useCollection(transaksiCol.where('tanggal', '==', todayDateString)),\n        _useCollection4 = _slicedToArray(_useCollection3, 2),\n        snapshotTransaksi = _useCollection4[0],\n        loadingTransaksi = _useCollection4[1];\n\n  const _useSnackbar = useSnackbar(),\n        enqueueSnackbar = _useSnackbar.enqueueSnackbar;\n\n  const initialTransaksi = {\n    no: '',\n    items: {},\n    total: 0,\n    tanggal: todayDateString\n  };\n\n  const _useState = useState(initialTransaksi),\n        _useState2 = _slicedToArray(_useState, 2),\n        transaksi = _useState2[0],\n        setTransaksi = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        produkItems = _useState4[0],\n        setProdukItems = _useState4[1];\n\n  const _useState5 = useState(''),\n        _useState6 = _slicedToArray(_useState5, 2),\n        filterProduk = _useState6[0],\n        setFilterProduk = _useState6[1];\n\n  const classes = useStyles();\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        isSubmitting = _useState8[0],\n        setSubmitting = _useState8[1];\n\n  useEffect(() => {\n    if (snapshotTransaksi) {\n      setTransaksi(transaksi => _objectSpread(_objectSpread({}, transaksi), {}, {\n        no: \"\".concat(transaksi.tanggal, \"/\").concat(snapshotTransaksi.docs.length + 1)\n      }));\n    } else {\n      setTransaksi(transaksi => _objectSpread(_objectSpread({}, transaksi), {}, {\n        no: \"\".concat(transaksi.tanggal, \"/1\")\n      }));\n    }\n  }, [snapshotTransaksi]);\n  useEffect(() => {\n    if (snapshotProduk) {\n      setProdukItems(snapshotProduk.docs.filter(produkDoc => {\n        if (filterProduk) {\n          return produkDoc.data().nama.toLowerCase().includes(filterProduk.toLowerCase());\n        }\n\n        return true;\n      }));\n    }\n  }, [snapshotProduk, filterProduk]);\n\n  const addItem = produkDoc => e => {\n    let newItem = _objectSpread({}, transaksi.items[produkDoc.id]);\n\n    const produkData = produkDoc.data();\n\n    if (newItem.jumlah) {\n      newItem.jumlah = newItem.jumlah + 1;\n      newItem.subtotal = produkData.harga * newItem.jumlah;\n    } else {\n      newItem.jumlah = 1;\n      newItem.harga = produkData.harga;\n      newItem.subtotal = produkData.harga;\n      newItem.nama = produkData.nama;\n    }\n\n    const newItems = _objectSpread(_objectSpread({}, transaksi.items), {}, {\n      [produkDoc.id]: newItem\n    });\n\n    if (newItem.jumlah > produkData.stock) {\n      enqueueSnackbar(\"Jumlah melebihi stok produk\", {\n        variant: 'error'\n      });\n    } else {\n      setTransaksi(_objectSpread(_objectSpread({}, transaksi), {}, {\n        items: newItems,\n        total: Object.keys(newItems).reduce((total, k) => {\n          const item = newItems[k];\n          return total + parseInt(item.subtotal);\n        }, 0)\n      }));\n    }\n  };\n\n  const handleChangeJumlah = k => e => {\n    let newItem = _objectSpread({}, transaksi.items[k]);\n\n    newItem.jumlah = parseInt(e.target.value);\n    newItem.subtotal = newItem.harga * newItem.jumlah;\n\n    const newItems = _objectSpread(_objectSpread({}, transaksi.items), {}, {\n      [k]: newItem\n    });\n\n    const produkDoc = produkItems.find(item => item.id === k);\n    const produkData = produkDoc.data();\n\n    if (newItem.jumlah > produkData.stock) {\n      enqueueSnackbar(\"Jumlah melebihi stok produk\", {\n        variant: 'error'\n      });\n    } else {\n      setTransaksi(_objectSpread(_objectSpread({}, transaksi), {}, {\n        items: newItems,\n        total: Object.keys(newItems).reduce((total, k) => {\n          const item = newItems[k];\n          return total + parseInt(item.subtotal);\n        }, 0)\n      }));\n    }\n  };\n\n  const simpanTransaksi = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            if (Object.keys(transaksi.items).length <= 0) {\n              enqueueSnackbar(\"Tidak ada transaksi yang disimpan\", {\n                variant: 'error'\n              });\n            }\n\n            setSubmitting(true);\n            _context.prev = 2;\n            _context.next = 5;\n            return transaksiCol.add(_objectSpread(_objectSpread({}, transaksi), {}, {\n              timestamp: Date.now()\n            }));\n\n          case 5:\n            _context.next = 7;\n            return firestore.runTransaction(transaction => {\n              const produkIDs = Object.keys(transaksi.items);\n              return Promise.all(produkIDs.map(produkId => {\n                const produkRef = firestore.doc(\"toko/\".concat(user.uid, \"/produk/\").concat(produkId));\n                return transaction.get(produkRef).then(produkDoc => {\n                  if (!produkDoc.exists) {\n                    throw Error('Produk tidak ada');\n                  }\n\n                  let newStok = parseInt(produkDoc.data().stock) - parseInt(transaksi.items[produkId].jumlah);\n\n                  if (newStok < 0) {\n                    newStok = 0;\n                  }\n\n                  transaction.update(produkRef, {\n                    stock: newStok\n                  });\n                });\n              }));\n            });\n\n          case 7:\n            enqueueSnackbar('Transaksi berhasil disimpan', {\n              variant: 'success'\n            });\n            setTransaksi(transaksi => _objectSpread(_objectSpread({}, initialTransaksi), {}, {\n              no: transaksi.no\n            }));\n            _context.next = 14;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](2);\n            enqueueSnackbar(_context.t0.message, {\n              variant: 'error'\n            });\n\n          case 14:\n            setSubmitting(false);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[2, 11]]);\n    }));\n\n    return function simpanTransaksi(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (loadingProduk || loadingTransaksi) {\n    return /*#__PURE__*/React.createElement(AppLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 16\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h5\",\n    component: \"h1\",\n    paragraph: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 12\n    }\n  }, \"Buat Transaksi Baru\"), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    label: \"No Transaksi\",\n    color: \"primary\",\n    value: transaksi.no,\n    InputProps: {\n      readOnly: true\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: simpanTransaksi,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 17\n    }\n  }, \"Simpan Transaksi\"))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 16\n    }\n  }, /*#__PURE__*/React.createElement(Table, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(TableHead, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 25\n    }\n  }, \"Item\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 25\n    }\n  }, \"Jumlah\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 25\n    }\n  }, \"Harga\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 25\n    }\n  }, \"Subtotal\")), /*#__PURE__*/React.createElement(TableBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 21\n    }\n  }, Object.keys(transaksi.items).map(k => {\n    const item = transaksi.items[k];\n    console.log(item);\n    return /*#__PURE__*/React.createElement(TableRow, {\n      key: k,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(TableCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 41\n      }\n    }, item.nama), /*#__PURE__*/React.createElement(TableCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      disabled: isSubmitting,\n      className: classes.inputJumlah,\n      onChange: handleChangeJumlah(k),\n      value: item.jumlah,\n      type: \"number\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 45\n      }\n    })), /*#__PURE__*/React.createElement(TableCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 41\n      }\n    }, currency(item.harga)), /*#__PURE__*/React.createElement(TableCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 41\n      }\n    }, currency(item.subtotal)));\n  }), /*#__PURE__*/React.createElement(TableRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(TableCell, {\n    colSpan: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 33\n    }\n  }, \"Total\")), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 33\n    }\n  }, currency(transaksi.total))))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 16\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    className: classes.produkList,\n    component: \"nav\",\n    subheader: /*#__PURE__*/React.createElement(ListSubheader, {\n      component: \"div\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      label: \"Cari Produk\",\n      fullWidth: true,\n      margin: \"normal\",\n      onChange: e => {\n        setFilterProduk(e.target.value);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 29\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 20\n    }\n  }, produkItems.map(produkDoc => {\n    const produkData = produkDoc.data();\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: produkDoc.id,\n      button: true,\n      disabled: produkData.stock == 0 || isSubmitting,\n      onClick: addItem(produkDoc),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 40\n      }\n    }, produkData.foto ? /*#__PURE__*/React.createElement(ListItemAvatar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(Avatar, {\n      src: produkData.foto,\n      alt: produkData.nama,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 45\n      }\n    })) : /*#__PURE__*/React.createElement(ListItemIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(ImageIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 45\n      }\n    })), /*#__PURE__*/React.createElement(ListItemText, {\n      primary: produkData.nama,\n      secondary: \"Stock :\".concat(produkData.stock || 0),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 41\n      }\n    }));\n  })))), /*#__PURE__*/React.createElement(Button, {\n    onClick: e => {\n      auth.signOut();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 13\n    }\n  }, \"Sign Out\"));\n}","map":{"version":3,"sources":["/home/irfan91/Desktop/aplikasi-keuangan/src/scenes/private/home /index.js"],"names":["React","useState","useEffect","Button","List","ListItem","ListSubheader","ListItemAvatar","ListItemIcon","ListItemText","Typography","Grid","Avatar","ImageIcon","TextField","Table","TableRow","TableHead","TableBody","TableCell","useFirebase","useCollection","AppLoading","useStyles","useSnackbar","currency","format","parse","Home","auth","firestore","user","produkCol","collection","uid","transaksiCol","todayDateString","Date","snapshotProduk","loadingProduk","where","snapshotTransaksi","loadingTransaksi","enqueueSnackbar","initialTransaksi","no","items","total","tanggal","transaksi","setTransaksi","produkItems","setProdukItems","filterProduk","setFilterProduk","classes","isSubmitting","setSubmitting","docs","length","filter","produkDoc","data","nama","toLowerCase","includes","addItem","e","newItem","id","produkData","jumlah","subtotal","harga","newItems","stock","variant","Object","keys","reduce","k","item","parseInt","handleChangeJumlah","target","value","find","simpanTransaksi","add","timestamp","now","runTransaction","transaction","produkIDs","Promise","all","map","produkId","produkRef","doc","get","then","exists","Error","newStok","update","message","readOnly","console","log","inputJumlah","produkList","foto","signOut"],"mappings":"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","sourcesContent":["import React ,{useState, useEffect }from 'react'\nimport Button from '@material-ui/core/Button'\nimport List from '@material-ui/core/List'\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListSubheader from \"@material-ui/core/ListSubheader\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport ImageIcon from \"@material-ui/icons/Image\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Table from \"@material-ui/core/Table\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\n\n//firebase hook\nimport { useFirebase } from '../../../components/FirebaseProvider'\nimport {useCollection} from 'react-firebase-hooks/firestore';\n\n//import komponent \nimport AppLoading from \"../../../components/AppLoading\";\n\n//import style\nimport useStyles from \"./style\";\n\n//import notifikasi\nimport {useSnackbar} from \"notistack\";\n\n\n//import helper\nimport { currency } from \"../../../helpers/formatter\";\n\n// import date format\nimport format from \"date-fns/format\";\nimport { parse } from 'date-fns';\nexport default function Home() {\n\n    const {auth , firestore, user} = useFirebase();\n    const produkCol = firestore.collection(`toko/${user.uid}/produk`);\n    const transaksiCol = firestore.collection(`toko/${user.uid}/transaksi`);\n    const todayDateString = format(new Date(),'yyyy-MM-dd');\n    const [snapshotProduk , loadingProduk] = useCollection(produkCol);\n    const [snapshotTransaksi, loadingTransaksi] = useCollection(transaksiCol.where('tanggal','==',todayDateString));\n    const {enqueueSnackbar} = useSnackbar();\n    const initialTransaksi = {\n        no :'',\n        items :{\n\n        },\n        total : 0,\n        tanggal : todayDateString\n    }\n    const [transaksi, setTransaksi] = useState(initialTransaksi);\n    const [produkItems , setProdukItems] = useState([]);\n    const [filterProduk, setFilterProduk] = useState('');\n    const classes = useStyles();\n    const [isSubmitting,setSubmitting] = useState(false);\n\n    useEffect(() => {\n\n        if(snapshotTransaksi){\n            setTransaksi(transaksi =>({\n                ...transaksi,\n                no : `${transaksi.tanggal}/${snapshotTransaksi.docs.length + 1}`\n            }))\n        } else {\n\n            setTransaksi(transaksi =>({\n                ...transaksi,\n                no : `${transaksi.tanggal}/1`\n            }))\n        }\n\n    },[snapshotTransaksi]);\n\n    useEffect(()=>{\n\n        if(snapshotProduk){\n            setProdukItems(snapshotProduk.docs.filter((produkDoc)=>{\n                if(filterProduk){\n                    return produkDoc.data().nama.toLowerCase().includes(filterProduk.toLowerCase());\n                }\n\n                return true;\n            }));\n        }\n    }, [snapshotProduk, filterProduk]);\n\n\n    const addItem = produkDoc => e =>{\n\n        let newItem = {...transaksi.items[produkDoc.id]};\n\n        const produkData = produkDoc.data();\n        if(newItem.jumlah){\n            newItem.jumlah = newItem.jumlah + 1;\n            newItem.subtotal = produkData.harga * newItem.jumlah;\n        \n\n        }else{\n            newItem.jumlah = 1;\n            newItem.harga = produkData.harga;\n            newItem.subtotal = produkData.harga;\n            newItem.nama = produkData.nama;\n        }\n\n        const newItems = {\n            ...transaksi.items,\n            [produkDoc.id] : newItem\n\n        };\n\n        if(newItem.jumlah > produkData.stock){\n            enqueueSnackbar(`Jumlah melebihi stok produk` ,{variant : 'error'});\n        } else {\n\n            setTransaksi(({\n                ...transaksi,\n                items : newItems,\n                total :Object.keys(newItems).reduce(\n                    (total,k) => {\n                        const item = newItems[k];\n                        return total + parseInt(item.subtotal);\n                    }, 0\n                )\n            }))\n        }\n    }\n\n\n    const handleChangeJumlah = k => e =>{\n        let newItem = {...transaksi.items[k]};\n\n        newItem.jumlah = parseInt(e.target.value);\n        newItem.subtotal = newItem.harga * newItem.jumlah;\n\n        const newItems = {\n            ...transaksi.items,\n            [k] : newItem\n\n        };\n\n        const produkDoc = produkItems.find(item=>item.id === k);\n        const produkData = produkDoc.data();\n\n        if(newItem.jumlah > produkData.stock){\n            enqueueSnackbar(`Jumlah melebihi stok produk` ,{variant : 'error'});\n        } else {\n\n            setTransaksi(({\n                ...transaksi,\n                items : newItems,\n                total :Object.keys(newItems).reduce(\n                    (total,k) => {\n                        const item = newItems[k];\n                        return total + parseInt(item.subtotal);\n                    }, 0\n                )\n            }))\n        }\n    }\n\n    const simpanTransaksi = async (e) =>{\n            if(Object.keys(transaksi.items).length <= 0){\n                enqueueSnackbar(\"Tidak ada transaksi yang disimpan\", {variant : 'error'});\n            }\n\n            setSubmitting(true);\n            try {\n            await transaksiCol.add({\n                ...transaksi,\n                timestamp:Date.now()\n            })\n\n            // update stock produk denngan menggunakan transactions\n\n            await firestore.runTransaction(transaction=>{\n                const produkIDs = Object.keys(transaksi.items);\n\n                return Promise.all(produkIDs.map(produkId => {\n\n                    const produkRef = firestore.doc(`toko/${user.uid}/produk/${produkId}`);\n\n                    return transaction.get(produkRef).then((produkDoc) => {\n\n                        if(!produkDoc.exists){\n                            throw Error('Produk tidak ada');\n                        }\n\n                        let newStok = parseInt(produkDoc.data().stock) - parseInt(transaksi.items[produkId].jumlah);\n\n                        if(newStok < 0){\n                            newStok = 0;\n                        }\n\n                        transaction.update(produkRef, {stock : newStok});\n\n                    })\n                }));\n            })\n\n            enqueueSnackbar('Transaksi berhasil disimpan', {variant : 'success'});\n            setTransaksi( transaksi =>({\n                    ...initialTransaksi,\n                    no : transaksi.no\n            }));\n\n            } catch(e){\n                enqueueSnackbar(e.message , {variant:'error'});\n            }\n            setSubmitting(false);\n    }\n\n    if(loadingProduk || loadingTransaksi){\n        return <AppLoading />\n    }\n  \n    return (\n        <div>\n           <Typography variant=\"h5\" component=\"h1\" paragraph>\n               Buat Transaksi Baru\n           </Typography>\n           <Grid container spacing={3}>\n\n           <Grid item xs>\n                <TextField \n                    label=\"No Transaksi\"\n                    color =\"primary\"\n                    value={transaksi.no}\n                    InputProps={{\n                        readOnly : true\n                    }}\n                />\n            </Grid>\n\n            <Grid item>\n                <Button\n                    variant=\"contained\"\n                    color=\"primary\"\n                    onClick={simpanTransaksi}\n                    disabled={isSubmitting}\n                >Simpan Transaksi</Button>\n            </Grid>\n\n\n           </Grid>\n           \n           <Grid container spacing={5}>\n               <Grid item xs={12} md={8}>\n                <Table>\n                    <TableHead>\n                        <TableCell>Item</TableCell>\n                        <TableCell>Jumlah</TableCell>\n                        <TableCell>Harga</TableCell>\n                        <TableCell>Subtotal</TableCell>\n                    </TableHead>\n                    <TableBody>\n                        {\n                            Object.keys(transaksi.items).map(k =>{\n                                const item = transaksi.items[k];\n                                console.log(item);\n                                return (\n                                    <TableRow key={k}>\n                                        <TableCell>{item.nama}</TableCell>\n                                        <TableCell>\n                                            <TextField\n                                             disabled={isSubmitting} \n                                            className={classes.inputJumlah}\n                                            onChange={handleChangeJumlah(k)}\n                                            value={item.jumlah} type=\"number\"/>\n                                        </TableCell>\n                                        <TableCell>{currency(item.harga)}</TableCell>\n                                        <TableCell>{currency(item.subtotal)}</TableCell>\n                                    </TableRow>\n                                )\n                            })\n                        }\n\n                        <TableRow>\n                            <TableCell colSpan={3}>\n                                <Typography\n                                variant=\"subtitle1\">\n                                    Total\n                                </Typography> \n                            </TableCell>\n                            <TableCell>\n                                <Typography variant=\"h6\">\n                                {currency(transaksi.total)}\n                                </Typography>\n                            </TableCell>\n                        </TableRow>\n                    </TableBody>\n                </Table>\n               </Grid>\n               <Grid item xs={12} md={4}>\n                   <List\n                   className={classes.produkList}\n                    component=\"nav\"\n                    subheader={\n                        <ListSubheader component=\"div\">\n                            <TextField\n                            label=\"Cari Produk\"\n                            fullWidth\n                            margin=\"normal\"\n                            onChange={e => {\n                                setFilterProduk(e.target.value);\n                            }}\n                            />\n                        </ListSubheader>\n                    }\n                   >\n                        {\n                            produkItems.map((produkDoc)=>{\n                                const produkData = produkDoc.data();\n                                return <ListItem\n                                    key={produkDoc.id} \n                                    button\n                                    disabled={produkData.stock == 0 || isSubmitting}\n                                    onClick={addItem(produkDoc)}\n                                >\n                                    {\n                                        produkData.foto?\n                                        <ListItemAvatar>\n                                            <Avatar \n                                                src={produkData.foto}\n                                                alt={produkData.nama}\n                                            />\n                                        </ListItemAvatar>\n                                        :\n                                        <ListItemIcon>\n                                            <ImageIcon />\n                                        </ListItemIcon>\n                                    }\n                                        <ListItemText\n                                            primary={produkData.nama}\n                                            secondary={`Stock :${produkData.stock || 0}`}\n                                        />\n                                </ListItem>\n                            })\n                        }\n                   </List>\n\n               </Grid>\n\n           </Grid>\n            <Button onClick={(e)=>{auth.signOut()}}>Sign Out</Button>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}