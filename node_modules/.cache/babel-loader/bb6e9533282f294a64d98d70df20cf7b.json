{"ast":null,"code":"import _regeneratorRuntime from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/irfan91/Desktop/aplikasi-keuangan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/irfan91/Desktop/aplikasi-keuangan/src/scenes/private/produk/edit.js\";\nimport React, { useState, useEffect, useRef } from 'react'; //material -ui\n\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport UploadIcon from \"@material-ui/icons/CloudUpload\";\nimport SaveIcon from \"@material-ui/icons/Save\"; // firebase hook\n\nimport { useFirebase } from \"../../../components/FirebaseProvider\";\nimport { useDocument } from \"react-firebase-hooks/firestore\"; //import component \n\nimport AppPageLoading from '../../../components/AppLoading'; //import notifikasi\n\nimport { useSnackbar } from 'notistack'; //import styles\n\nimport useStyles from \"./style/edit\"; //import react router dom\n\nimport { Prompt } from \"react-router-dom\";\nexport default function EditProduk({\n  match\n}) {\n  const _useFirebase = useFirebase(),\n        firestore = _useFirebase.firestore,\n        user = _useFirebase.user,\n        storage = _useFirebase.storage;\n\n  const produkDoc = firestore.doc(\"toko/\".concat(user.uid, \"/produk/\").concat(match.params.produkId));\n\n  const _useDocument = useDocument(produkDoc),\n        _useDocument2 = _slicedToArray(_useDocument, 2),\n        snapshot = _useDocument2[0],\n        loading = _useDocument2[1];\n\n  const produkStorageRef = storage.ref(\"toko/\".concat(user.uid, \"/produk\"));\n\n  const _useSnackbar = useSnackbar(),\n        enqueueSnackbar = _useSnackbar.enqueueSnackbar;\n\n  const classes = useStyles();\n\n  const _useState = useState({\n    nama: '',\n    sku: '',\n    harga: 0,\n    stock: 0,\n    deskripsi: '',\n    foto: ''\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        form = _useState2[0],\n        setForm = _useState2[1];\n\n  const _useState3 = useState({\n    nama: '',\n    sku: '',\n    harga: '',\n    stock: '',\n    deskripsi: ''\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        error = _useState4[0],\n        setError = _useState4[1];\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        isSubmitting = _useState6[0],\n        setSubmitting = _useState6[1];\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        isSomethingChange = _useState8[0],\n        setSomethingChange = _useState8[1];\n\n  useEffect(() => {\n    if (snapshot) {\n      setForm(currentForm => _objectSpread(_objectSpread({}, currentForm), snapshot.data()));\n    }\n  }, [snapshot]);\n\n  const handleChange = e => {\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      [e.target.name]: e.target.value\n    }));\n    setError(_objectSpread(_objectSpread({}, error), {}, {\n      [e.target.name]: ''\n    }));\n    setSomethingChange(true);\n  };\n\n  const validate = () => {\n    const newError = _objectSpread({}, error);\n\n    if (!form.nama) {\n      newError.nama = \"Nama harus diisi\";\n    }\n\n    if (!form.harga) {\n      newError.harga = \"Harga harus diisi\";\n    }\n\n    if (!form.stock) {\n      newError.stock = \"Stock harus diisi\";\n    }\n\n    return newError;\n  };\n\n  const handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var findErrors;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            e.preventDefault();\n            findErrors = validate();\n\n            if (!Object.values(findErrors).some(err => err !== '')) {\n              _context.next = 6;\n              break;\n            }\n\n            setError(findErrors);\n            _context.next = 18;\n            break;\n\n          case 6:\n            setSubmitting(true);\n            _context.prev = 7;\n            _context.next = 10;\n            return produkDoc.set(form, {\n              merge: true\n            });\n\n          case 10:\n            enqueueSnackbar(\"Data Produk berhasil disimpan\", {\n              variant: 'success'\n            });\n            setSomethingChange(false);\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](7);\n            enqueueSnackbar(_context.t0.message, {\n              variant: 'error'\n            });\n\n          case 17:\n            setSubmitting(false);\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[7, 14]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  const handleUploadFile = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n      var file, reader;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            file = e.target.files[0];\n            console.log(file);\n\n            if (!['image/jpeg', 'image/png'].includes(file.type)) {\n              setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                foto: \"Tipe file tidak didukung : \".concat(file.type)\n              }));\n            } else if (file.size >= 512000) {\n              setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                foto: \"Ukuran terlalu besar melebihi 500kb\"\n              }));\n            } else {\n              reader = new FileReader();\n\n              reader.onabort = () => {\n                setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                  foto: \"Proses pembacaan file dibatalkan\"\n                }));\n              };\n\n              reader.onerror = () => {\n                setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                  foto: \"File tidak bisa dibaca\"\n                }));\n              };\n\n              reader.onload = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                var fotoExt, fotoRef, fotoSnapshot, fotoUrl;\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) switch (_context2.prev = _context2.next) {\n                    case 0:\n                      setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                        foto: \"\"\n                      }));\n                      setSubmitting(true);\n                      _context2.prev = 2;\n                      fotoExt = file.name.substring(file.name.lastIndexOf('.'));\n                      fotoRef = produkStorageRef.child(\"\".concat(match.params.produkId).concat(fotoExt));\n                      _context2.next = 7;\n                      return fotoRef.putString(reader.result, 'data_url');\n\n                    case 7:\n                      fotoSnapshot = _context2.sent;\n                      _context2.next = 10;\n                      return fotoSnapshot.ref.getDownloadURL();\n\n                    case 10:\n                      fotoUrl = _context2.sent;\n                      setForm(currentForm => _objectSpread(_objectSpread({}, currentForm), {}, {\n                        foto: fotoUrl\n                      }));\n                      setSomethingChange(true);\n                      _context2.next = 18;\n                      break;\n\n                    case 15:\n                      _context2.prev = 15;\n                      _context2.t0 = _context2[\"catch\"](2);\n                      setError(error => _objectSpread(_objectSpread({}, error), {}, {\n                        foto: _context2.t0.message\n                      }));\n\n                    case 18:\n                      setSubmitting(false);\n\n                    case 19:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }, _callee2, null, [[2, 15]]);\n              }));\n              reader.readAsDataURL(file);\n            }\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }));\n\n    return function handleUploadFile(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(AppPageLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 16\n      }\n    });\n  }\n\n  console.log(error);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h5\",\n    component: \"h1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, \"Edit Produk: \", form.nama), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    justiify: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    id: \"produk-form\",\n    onSubmit: handleSubmit,\n    noValidate: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    id: \"nama\",\n    name: \"nama\",\n    label: \"Nama Produk\",\n    margin: \"normal\",\n    fullWidth: true,\n    value: form.nama,\n    onChange: handleChange,\n    helperText: error.nama,\n    error: error.nama ? true : false,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"sku\",\n    name: \"sku\",\n    label: \"SKU Produk\",\n    margin: \"normal\",\n    fullWidth: true,\n    value: form.sku,\n    onChange: handleChange,\n    helperText: error.sku,\n    error: error.sku ? true : false,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"harga\",\n    name: \"harga\",\n    label: \"Harga Produk\",\n    type: \"number\",\n    margin: \"normal\",\n    fullWidth: true,\n    value: form.harga,\n    onChange: handleChange,\n    helperText: error.harga,\n    error: error.harga ? true : false,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"stock\",\n    name: \"stock\",\n    label: \"Stock Produk\",\n    type: \"number\",\n    margin: \"normal\",\n    fullWidth: true,\n    value: form.stock,\n    onChange: handleChange,\n    helperText: error.stock,\n    error: error.stock ? true : false,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"deskripsi\",\n    name: \"deskripsi\",\n    label: \"Deskripsi Produk\",\n    margin: \"normal\",\n    fullWidth: true,\n    multiline: true,\n    rowsMax: 3,\n    value: form.deskripsi,\n    onChange: handleChange,\n    helperText: error.deskripsi,\n    error: error.deskripsi ? true : false,\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.uploadFotoProduk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 21\n    }\n  }, form.foto && /*#__PURE__*/React.createElement(\"img\", {\n    src: form.foto,\n    className: classes.previewFoto,\n    alt: \"Foto Produk \".concat(form.nama),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    className: classes.hideInputFile,\n    type: \"file\",\n    id: \"upload-foto-produk\",\n    accept: \"image/jpeg,image/png\",\n    onChange: handleUploadFile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"upload-foto-produk\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: isSubmitting,\n    component: \"span\",\n    variant: \"outlined\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 29\n    }\n  }, \"Upload Foto Produk\", /*#__PURE__*/React.createElement(UploadIcon, {\n    className: classes.iconRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 33\n    }\n  })), error.foto && /*#__PURE__*/React.createElement(Typography, {\n    color: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 37\n    }\n  }, error.foto)))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Button //    disabled={isSubmitting || isSomethingChange}\n  , {\n    form: \"produk-form\",\n    type: \"submit\",\n    color: \"primary\",\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(SaveIcon, {\n    className: classes.iconLeft,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 29\n    }\n  }), \"Simpan\")))), /*#__PURE__*/React.createElement(Prompt, {\n    when: isSomethingChange,\n    message: \"Terdapat perubahan yang belum disimpan, Apakah anda yakin meninggalkan halaman ?\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }));\n}","map":{"version":3,"sources":["/home/irfan91/Desktop/aplikasi-keuangan/src/scenes/private/produk/edit.js"],"names":["React","useState","useEffect","useRef","TextField","Button","Grid","Typography","UploadIcon","SaveIcon","useFirebase","useDocument","AppPageLoading","useSnackbar","useStyles","Prompt","EditProduk","match","firestore","user","storage","produkDoc","doc","uid","params","produkId","snapshot","loading","produkStorageRef","ref","enqueueSnackbar","classes","nama","sku","harga","stock","deskripsi","foto","form","setForm","error","setError","isSubmitting","setSubmitting","isSomethingChange","setSomethingChange","currentForm","data","handleChange","e","target","name","value","validate","newError","handleSubmit","preventDefault","findErrors","Object","values","some","err","set","merge","variant","message","handleUploadFile","file","files","console","log","includes","type","size","reader","FileReader","onabort","onerror","onload","fotoExt","substring","lastIndexOf","fotoRef","child","putString","result","fotoSnapshot","getDownloadURL","fotoUrl","readAsDataURL","uploadFotoProduk","previewFoto","hideInputFile","iconRight","actionButton","iconLeft"],"mappings":"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","sourcesContent":["import React ,{useState , useEffect , useRef}  from 'react'\n\n//material -ui\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport UploadIcon from \"@material-ui/icons/CloudUpload\";\nimport SaveIcon from \"@material-ui/icons/Save\";\n\n// firebase hook\nimport { useFirebase } from \"../../../components/FirebaseProvider\";\nimport { useDocument } from \"react-firebase-hooks/firestore\";\n\n\n//import component \nimport AppPageLoading from '../../../components/AppLoading';\n\n//import notifikasi\nimport {useSnackbar} from 'notistack'\n\n//import styles\nimport useStyles from \"./style/edit\";\n\n//import react router dom\nimport { Prompt } from \"react-router-dom\";\n\nexport default function EditProduk({match}) {\n\n    const {firestore, user, storage} = useFirebase();\n\n    const produkDoc = firestore.doc(`toko/${user.uid}/produk/${match.params.produkId}`);\n    const [snapshot , loading] = useDocument(produkDoc);\n    const produkStorageRef = storage.ref(`toko/${user.uid}/produk`);\n\n    const {enqueueSnackbar} = useSnackbar();\n\n    const classes = useStyles();\n\n    const [form, setForm] = useState({\n        nama :'',\n        sku : '',\n        harga : 0,\n        stock : 0,\n        deskripsi : '',\n        foto : ''\n      \n    });\n\n    const [error, setError] = useState({\n        nama :'',\n        sku : '',\n        harga : '',\n        stock:'',\n        deskripsi : '',\n     \n    });\n\n    const [isSubmitting, setSubmitting] = useState(false);\n    const [isSomethingChange, setSomethingChange] = useState(false);\n\n    useEffect(()=>{\n        if(snapshot){\n            setForm(currentForm=>({...currentForm,...snapshot.data()}) );\n        }\n    }, [snapshot]);\n\n    const handleChange = (e) => {\n        setForm({\n            ...form,\n            [e.target.name]: e.target.value\n        })\n\n        setError({\n            ...error,\n            [e.target.name] : ''\n        })\n\n        setSomethingChange(true);\n    }\n\n    const validate = ()=>{\n        const newError = {...error};\n        \n        if(!form.nama){\n            newError.nama = \"Nama harus diisi\";\n\n        }\n\n        if(!form.harga){\n            newError.harga = \"Harga harus diisi\";\n\n        }\n\n        if(!form.stock){\n            newError.stock = \"Stock harus diisi\";\n\n        }\n\n        return newError;\n\n\n    }\n\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n\n        const findErrors = validate();\n\n        if(Object.values(findErrors).some(err => err !== '')){\n\n            setError(findErrors);\n\n        }else{\n\n            setSubmitting(true);\n            try{\n\n                await produkDoc.set(form,{merge:true});\n                enqueueSnackbar(\"Data Produk berhasil disimpan\", {variant : 'success'});\n                setSomethingChange(false);\n\n            } catch(e) {\n                enqueueSnackbar(e.message, {variant : 'error'});\n            }\n            setSubmitting(false)\n\n        }\n\n    }\n\n    const handleUploadFile = async (e) => {\n        const file = e.target.files[0];\n\n        console.log(file);\n\n        if(!['image/jpeg','image/png'].includes(file.type)){\n            setError(error => ({\n                ...error,\n                foto : `Tipe file tidak didukung : ${file.type}`\n            }))\n        } else if(file.size >= 512000) {\n\n            setError(error => ({\n                ...error,\n                foto : `Ukuran terlalu besar melebihi 500kb`\n            }))\n        } else {\n\n            const reader = new FileReader();\n\n            reader.onabort = ()=>{\n                setError(error => ({\n                    ...error,\n                    foto : `Proses pembacaan file dibatalkan`\n                }))\n            }\n\n            reader.onerror = ()=>{\n                setError(error => ({\n                    ...error,\n                    foto : `File tidak bisa dibaca`\n                }))\n                \n            }\n\n            reader.onload = async  ()=>{\n\n                setError(error => ({\n                    ...error,\n                    foto : ``\n                }))\n\n                setSubmitting(true);\n\n                try{\n\n                    const fotoExt = file.name.substring(file.name.lastIndexOf('.'));\n\n                    const fotoRef = produkStorageRef.child(`${match.params.produkId}${fotoExt}`);\n\n                    const fotoSnapshot = await fotoRef.putString(reader.result,'data_url');\n\n                    const fotoUrl = await fotoSnapshot.ref.getDownloadURL();\n\n                    setForm(currentForm=>({\n                        ...currentForm,\n                        foto: fotoUrl\n                    }))\n\n                    setSomethingChange(true);\n\n                } catch(e){\n\n                    setError(error => ({\n                        ...error,\n                        foto : e.message\n                    }))\n\n                }\n\n               setSubmitting(false);\n            }\n\n            reader.readAsDataURL(file);\n        }\n        \n        \n    }\n\n    if(loading){\n        return <AppPageLoading />\n    }\n\n    console.log(error);\n    return (\n        <div>\n            <Typography variant=\"h5\" component=\"h1\">Edit Produk: {form.nama}</Typography>\n            <Grid container alignItems=\"center\" justiify=\"center\">\n                <Grid item xs={12} sm={6}>\n                    <form id=\"produk-form\" onSubmit={handleSubmit} noValidate>\n                        <TextField \n                            id=\"nama\"\n                            name=\"nama\"\n                            label=\"Nama Produk\"\n                            margin=\"normal\"\n                            fullWidth\n                            value={form.nama}\n                            onChange={handleChange}\n                            helperText={error.nama}\n                            error={error.nama?true:false}\n                            disabled={isSubmitting}\n                        />\n\n                        <TextField \n                            id=\"sku\"\n                            name=\"sku\"\n                            label=\"SKU Produk\"\n                            margin=\"normal\"\n                            fullWidth\n                            value={form.sku}\n                            onChange={handleChange}\n                            helperText={error.sku}\n                            error={error.sku?true:false}\n                            disabled={isSubmitting}\n                        />  \n\n                        <TextField \n                            id=\"harga\"\n                            name=\"harga\"\n                            label=\"Harga Produk\"\n                            type=\"number\"\n                            margin=\"normal\"\n                            fullWidth\n                            value={form.harga}\n                            onChange={handleChange}\n                            helperText={error.harga}\n                            error={error.harga?true:false}\n                            disabled={isSubmitting}\n                        />\n\n\n                    <TextField \n                            id=\"stock\"\n                            name=\"stock\"\n                            label=\"Stock Produk\"\n                            type=\"number\"\n                            margin=\"normal\"\n                            fullWidth\n                            value={form.stock}\n                            onChange={handleChange}\n                            helperText={error.stock}\n                            error={error.stock?true:false}\n                            disabled={isSubmitting}\n                        />\n\n                    <TextField \n                            id=\"deskripsi\"\n                            name=\"deskripsi\"\n                            label=\"Deskripsi Produk\"\n                            margin=\"normal\"\n                            fullWidth\n                            multiline\n                            rowsMax={3}\n                            value={form.deskripsi}\n                            onChange={handleChange}\n                            helperText={error.deskripsi}\n                            error={error.deskripsi?true:false}\n                            disabled={isSubmitting}\n                        />          \n                    </form>\n                </Grid>\n                <Grid item xs={12} sm={6}>\n                    <div className={classes.uploadFotoProduk}>\n                        { form.foto &&  \n                        <img src={form.foto} className={classes.previewFoto} alt={`Foto Produk ${form.nama}`} /> }\n                       \n                        <input\n                            className={classes.hideInputFile}\n                            type=\"file\"\n                            id=\"upload-foto-produk\"\n                            accept=\"image/jpeg,image/png\"\n                            onChange={handleUploadFile}\n                        />\n                          <label htmlFor=\"upload-foto-produk\">\n                            <Button\n                                disabled={isSubmitting}\n                                component=\"span\"\n                                variant=\"outlined\"\n                            \n                            >\n                                Upload Foto Produk\n                                <UploadIcon  className={classes.iconRight}/>\n                            </Button>\n\n                            {\n                              \n                                error.foto &&\n                                    <Typography color=\"error\">\n                                        {error.foto}\n                                    </Typography>\n\n                            }\n                          </label>\n                    </div>\n                  \n                </Grid>\n                <Grid item xs={12}>\n                    <div className={classes.actionButton}>\n                        <Button\n                        //    disabled={isSubmitting || isSomethingChange}\n                            form=\"produk-form\"\n                            type=\"submit\"\n                            color=\"primary\" \n                            variant=\"contained\">\n                            <SaveIcon className={classes.iconLeft}/>\n                            Simpan\n                        </Button>\n                    </div>\n                </Grid>\n            </Grid>\n            <Prompt \n                when={isSomethingChange}\n                message=\"Terdapat perubahan yang belum disimpan, Apakah anda yakin meninggalkan halaman ?\"\n            />\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}